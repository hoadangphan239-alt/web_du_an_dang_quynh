<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý User & Roles - Khách Sạn</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
        .table-container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .role-badge { min-width: 80px; text-align: center; }
        .btn-action { margin-right: 5px; }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold"><i class="fas fa-user-shield me-2"></i>Quản lý Tài khoản & Phân quyền</h2>
        <button class="btn btn-primary shadow-sm" id="btnAddNew">
            <i class="fas fa-plus me-1"></i> Thêm Người Dùng
        </button>
    </div>

    <div class="table-container">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Họ Tên</th>
                    <th>Email</th>
                    <th>Vai Trò (Role)</th>
                    <th>Trạng Thái</th>
                    <th class="text-center">Thao Tác</th>
                </tr>
            </thead>
            <tbody id="userTableBody">
                <tr>
                    <td>1</td>
                    <td class="user-name">Nguyễn Văn Admin</td>
                    <td class="user-email">admin@hotel.com</td>
                    <td><span class="badge bg-danger role-badge">Quản trị viên</span></td>
                    <td><span class="text-success"><i class="fas fa-check-circle me-1"></i>Hoạt động</span></td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-outline-info btn-edit btn-action"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-outline-danger btn-delete btn-action"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="userModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-light">
                <h5 class="modal-title fw-bold" id="modalTitle">Thêm Người Dùng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <input type="hidden" id="editUserId"> <div class="mb-3">
                        <label class="form-label">Họ tên</label>
                        <input type="text" class="form-control" id="userName" required placeholder="Nhập họ tên">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="userEmail" required placeholder="name@example.com">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Vai trò</label>
                        <select class="form-select" id="userRole">
                            <option value="Quản trị viên">Quản trị viên</option>
                            <option value="Lễ tân">Lễ tân</option>
                            <option value="Kế toán">Kế toán</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary px-4" id="btnSaveUser">Lưu thông tin</button>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
$(document).ready(function() {
    let currentRow = null;

    // Mở modal Thêm mới
    $('#btnAddNew').click(function() {
        $('#userForm')[0].reset();
        $('#editUserId').val('');
        $('#modalTitle').text('Thêm Người Dùng Mới');
        $('#userModal').modal('show');
    });

    // 1. Logic Nút Sửa: Lấy dữ liệu từ dòng hiện tại đưa lên Modal
    $(document).on('click', '.btn-edit', function() {
        currentRow = $(this).closest('tr');
        const id = currentRow.find('td:eq(0)').text();
        const name = currentRow.find('.user-name').text();
        const email = currentRow.find('.user-email').text();
        const role = currentRow.find('.role-badge').text();

        // Đổ vào form
        $('#editUserId').val(id);
        $('#userName').val(name);
        $('#userEmail').val(email);
        $('#userRole').val(role);

        $('#modalTitle').text('Chỉnh sửa người dùng ID: ' + id);
        $('#userModal').modal('show');
    });

    // 2. Logic Lưu (Cả Thêm & Sửa)
    $('#btnSaveUser').click(function() {
        const id = $('#editUserId').val();
        const name = $('#userName').val();
        const email = $('#userEmail').val();
        const role = $('#userRole').val();
        
        // Thiết lập màu sắc Badge dựa trên vai trò
        let badgeClass = 'bg-secondary';
        if (role === 'Quản trị viên') badgeClass = 'bg-danger';
        if (role === 'Lễ tân') badgeClass = 'bg-primary';

        if (name && email) {
            if (id) {
                // ĐANG SỬA: Cập nhật dòng hiện có
                currentRow.find('.user-name').text(name);
                currentRow.find('.user-email').text(email);
                currentRow.find('.role-badge').text(role)
                          .removeClass('bg-danger bg-primary bg-secondary')
                          .addClass(badgeClass);
                
                console.log("Đã cập nhật ID:", id);
            } else {
                // ĐANG THÊM: Tạo dòng mới (Giả lập ID tự tăng)
                const newId = Math.floor(Math.random() * 100) + 5;
                const newRow = `
                    <tr>
                        <td>${newId}</td>
                        <td class="user-name">${name}</td>
                        <td class="user-email">${email}</td>
                        <td><span class="badge ${badgeClass} role-badge">${role}</span></td>
                        <td><span class="text-success"><i class="fas fa-check-circle me-1"></i>Hoạt động</span></td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-outline-info btn-edit btn-action"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-outline-danger btn-delete btn-action"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`;
                $('#userTableBody').append(newRow);
            }
            $('#userModal').modal('hide');
        } else {
            alert("Vui lòng nhập đầy đủ thông tin!");
        }
    });

    // Logic Xóa dòng
    $(document).on('click', '.btn-delete', function() {
        if(confirm('Bạn có chắc chắn muốn xóa tài khoản này?')) {
            $(this).closest('tr').fadeOut(300, function() { $(this).remove(); });
        }
    });
});
</script>
</body>
</html>