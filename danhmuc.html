<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Quáº£n lÃ½ danh má»¥c dá»‹ch vá»¥</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<style>
body { background:#f8f9fa; }
.card { border-radius:12px }
.table th { background:#0d6efd; color:white }
</style>
</head>

<body>
<div class="container mt-4">
<div class="card shadow">
<div class="card-header d-flex justify-content-between">
<h5 class="mb-0">ğŸ“ Quáº£n lÃ½ Danh má»¥c dá»‹ch vá»¥</h5>
<button class="btn btn-primary" id="btnAdd">â• ThÃªm danh má»¥c</button>
</div>

<div class="card-body">
<input id="search" class="form-control mb-3" placeholder="ğŸ” TÃ¬m theo tÃªn danh má»¥c">

<table class="table table-bordered table-hover text-center align-middle">
<thead>
<tr>
<th>ID</th>
<th>TÃªn danh má»¥c</th>
<th>MÃ´ táº£</th>
<th>Tráº¡ng thÃ¡i</th>
<th>HÃ nh Ä‘á»™ng</th>
</tr>
</thead>
<tbody id="danhMucTable"></tbody>
</table>
</div>
</div>
</div>

<!-- MODAL -->
<div class="modal fade" id="modalDanhMuc">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Danh má»¥c dá»‹ch vá»¥</h5>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>

<div class="modal-body">
<input type="hidden" id="idDanhMuc">

<div class="mb-2">
<label>TÃªn danh má»¥c</label>
<input id="tenDanhMuc" class="form-control">
</div>

<div class="mb-2">
<label>MÃ´ táº£</label>
<textarea id="moTa" class="form-control"></textarea>
</div>

<div class="mb-2">
<label>Tráº¡ng thÃ¡i</label>
<select id="trangThai" class="form-select">
<option value="1">Hoáº¡t Ä‘á»™ng</option>
<option value="0">áº¨n</option>
</select>
</div>
</div>

<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal">ÄÃ³ng</button>
<button class="btn btn-success" id="btnSave">LÆ°u</button>
</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
$(function(){

    loadDanhMuc();

    function loadDanhMuc(){
        $.post("danh_muc_api.php",{action:"fetch"},function(res){
            let rows="";
            JSON.parse(res).forEach(dm=>{
                rows+=`
                <tr>
                    <td>${dm.id}</td>
                    <td>${dm.ten_danh_muc}</td>
                    <td>${dm.mo_ta ?? ""}</td>
                    <td>${dm.trang_thai==1?"Hoáº¡t Ä‘á»™ng":"áº¨n"}</td>
                    <td>
                        <button class="btn btn-warning btn-sm btnEdit"
                            data-id='${JSON.stringify(dm)}'>âœï¸</button>
                        <button class="btn btn-danger btn-sm btnDelete"
                            data-id="${dm.id}">ğŸ—‘</button>
                    </td>
                </tr>`;
            });
            $("#danhMucTable").html(rows);
        });
    }

    $("#btnAdd").click(()=>{
        $("#idDanhMuc").val("");
        $("#tenDanhMuc,#moTa").val("");
        $("#trangThai").val(1);
        $("#modalDanhMuc").modal("show");
    });

    $("#btnSave").click(()=>{
        let id=$("#idDanhMuc").val();
        let action=id?"update":"insert";

        $.post("danh_muc_api.php",{
            action:action,
            id:id,
            ten_danh_muc:$("#tenDanhMuc").val(),
            mo_ta:$("#moTa").val(),
            trang_thai:$("#trangThai").val()
        },()=>{
            $("#modalDanhMuc").modal("hide");
            loadDanhMuc();
        });
    });

    $(document).on("click",".btnEdit",function(){
        let d=$(this).data("id");
        $("#idDanhMuc").val(d.id);
        $("#tenDanhMuc").val(d.ten_danh_muc);
        $("#moTa").val(d.mo_ta);
        $("#trangThai").val(d.trang_thai);
        $("#modalDanhMuc").modal("show");
    });

    $(document).on("click",".btnDelete",function(){
        if(confirm("XÃ³a danh má»¥c nÃ y?")){
            $.post("danh_muc_api.php",
                {action:"delete",id:$(this).data("id")},
                loadDanhMuc
            );
        }
    });

    $("#search").keyup(function(){
        let v=$(this).val().toLowerCase();
        $("#danhMucTable tr").filter(function(){
            $(this).toggle($(this).text().toLowerCase().indexOf(v)>-1)
        });
    });

});
</script>
</body>
</html>
